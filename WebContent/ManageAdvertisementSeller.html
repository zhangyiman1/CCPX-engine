<!DOCTYPE html>
<html lang="en">

	<head>
		<title>Manage Advertisements</title>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link href="bootstrap/css/bootstrap.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="scripts/jquery.datetimepicker.css"/ >
		<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
		<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
		<!--[if lt IE 9]>
		  <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
		  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
		<![endif]-->
        <script src="scripts/jquery.min.js"></script>
		<script src="bootstrap/js/bootstrap.js"></script>
        <script src="scripts/jquery.datetimepicker.js"></script>
	</head>
	
	<body>
		<div class="container">
		
			<div class="header">

				<!-- Form Name -->
				<legend>Manage Advertisements</legend>
			
				<!-- Navbar --> 
				<nav class="navbar navbar-default" style="background-image: url('img/red.png'); background-position : 10% 10%;" role="navigation">
					<div class="container-fluid">  
						<div class="navbar-header">
							<button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
									data-target="#mynav">
								<span class="sr-only">change nav</span>
								<span class="icon-bar"></span>
								<span class="icon-bar"></span>
								<span class="icon-bar"></span>
								<span class="icon-bar"></span>
                                <span class="icon-bar"></span>
								<span class="icon-bar"></span>
					   
							</button>
							<a class="navbar-brand" href="#">Exchange Platform</a>
						</div>
						<div class="collapse navbar-collapse" id="mynav">
							<ul class="nav navbar-nav center-block pull-right">
									<li class="nav-item pull-left">
								  <a class="nav-link" href="HomePageSeller.html"><span class="glyphicon glyphicon-home"></span> Home </a>
								</li>
								
								<li class="nav-item pull-left">
								  <a class="nav-link" href="BusinessPage.html"><span class="glyphicon glyphicon-user"></span> Account </a>
								</li>
								
								 <li class="nav-item pull-left">
								  <a class="nav-link" href="Advertisements.html"><span class="glyphicon glyphicon-bullhorn"></span> Advertisements </a>
								</li>
								
								<li class="nav-item pull-left">
								<a class="nav-link" href="StatisticsCenter.html"><span class="glyphicon glyphicon-stats"></span> Statistics Center </a>
								</li>	
                                
                                <li class="nav-item pull-left">
								<a class="nav-link" href="MainPage.html"><span class="glyphicon glyphicon-log-out"></span> Logout </a>
								</li>															
							</ul>
						</div> 
					</div>
				</nav>
			
				<!-- Website Logo -->
				<div class="row">
					<label class="col-md-5 col-sm-4 col-xs-3 control-label" for="Logo"></label>
					<div class="col-md-2 col-sm-4 col-xs-6">
						<img class="img-responsive center-block" src="img/logo.png" width="60%" />
					</div>
				</div>
				
				
				
<!-- ********************************* ^ here ^ ********************************* -->
				<div class="container">
				  <!-- Trigger the modal with a button -->
				 <button type="button" class="btn btn-info btn-sm" data-toggle="modal" data-target="#myModal">Add Advertisement</button>
				 <br>
				 </br>

				    <!-- Modal -->
					  <div class="modal fade" id="myModal" role="dialog">
						<div class="modal-dialog modal-lg">
						  <div class="modal-content">
							<div class="modal-header">
							  <button type="button" class="close" data-dismiss="modal">&times;</button>
							  <h4 class="modal-title">New Advertisement</h4>
							</div>
							<div class="modal-body">
							<form id="inputform">
							  <div class="row">
							  <div class="col-md-4" style="vertical-align:middle;">
										<input type="file" name="file" id="file" />
							  </div>
							  <div class="col-md-8 form-group">
								  <label for="description">Description</label>
									<textarea class="form-control" rows="8" id="description"></textarea>
							  </div>
						</div>
						</form>
							</div>
							<div class="modal-footer">
							  <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
							  <button type="button" class="btn btn-primary">Save</button>
							</div>
						  </div>
						</div>
					  </div>
					</div>

				<div class="table-responsive">
					<table class="table table-bordered table-striped">
						<thead>
							<tr>
								<th>ID</th>
								<th>Image</th>
								<th>Description</th>
								<th>Edit</th>
							</tr>
						</thead>
						<tbody>
						<tr>
							<td>1</td>
							<td>
							<img class="center-block" src="img/Advertisement.png" name="myImage" width=150 height=110>
							</td>
							<td></td>
							<td><button type="button" data-id="1" class="btn btn-default editButton center-block">Edit</button></td>
						</tr>
					</table>
				</div>
				
				<form id="userForm" method="post" class="form-horizontal" style="display: none;">
					<div class="form-group">
						<label class="col-xs-3 control-label">ID</label>
						<div class="col-xs-3">
						<input type="text" class="form-control" name="id" disabled="disabled" />
						</div>
					</div>
					
					<div class="form-group">
						<label class="col-xs-3 control-label">Picture</label>
						<div class="col-xs-3">
						<input type="image" class="form-control" name="image" />
						</div>
					</div>
											
					<div class="form-group">
						<label class="col-xs-3 control-label">Description</label>
						<div class="col-xs-5">
						<input type="text" class="form-control" name="description" />
						</div>
					</div>

					<script>
					
						$("#yourButton").bind('click', function () {
							var data = new window.FormData($('#inputform')[0]);
							$.ajax({
								xhr: function () {  
									return $.ajaxSettings.xhr();
								},
								type: "POST",
								data: data,
								cache: false,
								contentType: false,
								processData: false,
								url: 'seller/addAdvertisement',
								success: function () { },
								error: function () { },
							});
						});
					
					canvas = new fabric.Canvas('c');

					document.getElementById('imgLoader').onchange = function handleImage(e) {
						var reader = new FileReader();
						reader.onload = function (event) { console.log('fdsf');
							var imgObj = new Image();
							imgObj.src = event.target.result;
							imgObj.onload = function () {									// start fabricJS stuff
								
								var image = new fabric.Image(imgObj);
									
									canvas.add(image);
									
									// end fabricJS stuff
								}
								
							}
							reader.readAsDataURL(e.target.files[0]);
						}
					
					$(document).ready(function() {
						$('#userForm')
							.on('success.form.fv', function(e) {
								// Save the form data via an Ajax request
								e.preventDefault();

								var $form = $(e.target),
									id    = $form.find('[name="id"]').val();

								$.ajax({
									url: 'seller/editAdvertisement' + id,
									method: 'PUT',
									data: $form.serialize()
								}).success(function(response) {
									// Get the cells
									var $button = $('button[data-id="' + response.id + '"]'),
										$tr     = $button.closest('tr'),
										$cells  = $tr.find('td');

									// Update the cell data
									$cells
										.eq(1).html(response.description).end()
										.eq(2).html(response.image).end()

									// Hide the dialog
									$form.parents('.bootbox').modal('hide');

									// You can inform the user that the data is updated successfully
									// by highlighting the row or showing a message box
									bootbox.alert('The Advertisement is updated');
								});
							});

						$('.editButton').on('click', function() {
							// Get the record's ID via attribute
							var id = $(this).attr('data-id');

							$.ajax({
								url: 'seller/getAdvertisement' + id,
								method: 'GET'
							}).success(function(response) {
								// Populate the form fields with the data returned from server
								$('#userForm')
									.find('[name="id"]').val(response.id).end()
									.find('[name="description"]').val(response.description).end()
									.find('[name="image"]').val(response.image).end()

								// Show the dialog
								bootbox
									.dialog({
										title: 'Edit the Advertisement',
										message: $('#userForm'),
										show: false // We will show it manually later
									})
									.on('shown.bs.modal', function() {
										$('#userForm')
											.show()
											.formValidation('resetForm');
									})
									.on('hide.bs.modal', function(e) {
										// Bootbox will remove the modal
										// after hiding the modal
										// Therefor, we need to backup the form
										$('#userForm').hide().appendTo('body');
									})
									.modal('show');
							});
						});
					});
					</script>
	</body>
  
</html>